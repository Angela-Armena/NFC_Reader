<!DOCTYPE html>
<html>

<head>
    <title>RFID Reader</title>
    <!-- Include Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <!-- Include NFC library -->
    <script src="https://googlechrome.github.io/samples/web-nfc/"></script>

    <!-- Include Bootstrap Native JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap.native@4.2.0/dist/bootstrap-native.min.js"></script>

    <style>
        .btn-scanning {
            background-color: green;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Wait for DOM to be ready

            // Initialize NFC library
            var nfct = window.nfct;

            // Get references to elements
            var button = document.getElementById("scanButton");
            var nfcInfoSN = document.querySelector(".nfc-info-sn");
            var nfcRecordsCount = document.querySelector(".nfc-records-count");

            // Attach a click event handler to the button
            button.addEventListener("click", function () {
                button.disabled = true;
                console.log("button clicked");

                // Request NFC permission
                if (navigator.nfc) {
                    navigator.nfc.requestPermission().then(() => {
                        console.log("reading");
                        // Permission granted, now you can read NFC
                        nfct.readOne().then((d) => {
                            // Update the NFC tag info table
                            nfcInfoSN.innerText = d.serialNumber;
                            nfcRecordsCount.innerText = d.message.records.length;
                        }).catch((e) => {
                            console.error(e);
                        });
                    }).catch((error) => {
                        console.error("NFC permission denied:", error);
                    });
                }
                else { console.log("NFC not scanning") }
            }); // Close the button click event handler
        }); // Close the DOMContentLoaded event listener
    </script>
</head>

<body>
    <main class="container-fluid" role="main">
        <header class="mb-3">
            <h1>Read NFC Tags</h1>
        </header>
        <div class="mb-2 d-grid"><button id="scanButton" class="btn btn-primary">Read NFC Tag</button></div>
        <div class="card mb-2">
            <h2 class="card-header text-center">NFC Tag Info</h2>
            <table class="table mb-0">
                <tbody>
                    <tr>
                        <th>Serial Number</th>
                        <td class="nfc-info-sn"></td>
                    </tr>
                    <tr>
                        <th>Record Count</th>
                        <td class="nfc-records-count"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="card mb-2 nfc-records-table-info-template" style="display:none">
            <h2 class="card-header text-center">Record <span class="nfc-records-index"></span></h2>
            <table class="table mb-0">
                <thead class="">
                    <tr>
                        <th>Record ID</th>
                        <td class="nfc-records-id"></td>
                    </tr>
                    <tr>
                        <th>Record Type</th>
                        <td class="nfc-records-type"></td>
                    </tr>
                    <tr>
                        <th>Media Type</th>
                        <td class="nfc-records-media-type"></td>
                    </tr>
                    <tr>
                        <th>Data Encoding</th>
                        <td class="nfc-records-encoding"></td>
                    </tr>
                    <tr>
                        <th>Data Size</th>
                        <td class="nfc-records-data-size"></td>
                    </tr>
                </thead>
            </table>
            <pre class="font-monospace card-body nfc-records-data" style="white-space: pre-wrap;"></pre>
        </div>
    </main>
</body>

</html>